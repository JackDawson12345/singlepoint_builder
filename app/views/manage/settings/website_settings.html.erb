<div>
  <div class="mb-5">
    <div class="flex gap-3">
      <%= link_to 'Settings', manage_settings_path, class: 'nata-sans font-normal text-sm' %>
      <svg style="transform: rotate(270deg)" class="w-5 h-5 ml-1 transform transition-transform duration-200 text-gray-300" id="quick-actions-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
      </svg>
      <p class="nata-sans font-normal text-sm">Website Settings</p>
    </div>
    <div class="flex items-center gap-3">
      <%= link_to manage_settings_path do %>
        <svg style="transform: rotate(90deg)" class="w-5 h-5 ml-1 transform transition-transform duration-200 text-blue-500" id="quick-actions-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
      <% end %>
      <h1 class="nata-sans page-title">Website Settings</h1>
    </div>
  </div>

  <div class="space-y-5">
    <div class="bg-gray-50 rounded-lg">
      <div class="py-4 px-6 border-b">
        <h2 class="nata-sans text-lg font-semibold">Site Name</h2>
        <p class="nata-sans text-sm font-normal">Edit the name to easily find it on your dashboard and more.</p>
      </div>
      <div class="py-4 px-6">
        <div class="border-b pb-4 flex">
          <div class="w-3/10 pr-4">
            <%= form_with url: manage_update_website_name_path, method: :patch, local: false, class: "w-full", id: "site-name-form" do |form| %>
              <%= form.text_field :site_name,
                                  placeholder: "Site name",
                                  value: @website.name,
                                  class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",
                                  onblur: "submitForm()" %>
            <% end %>

            <script>
                function submitForm() {
                    const form = document.getElementById('site-name-form');
                    const formData = new FormData(form);

                    fetch(form.action, {
                        method: 'PATCH',
                        body: formData,
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest',
                            'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
                        }
                    })
                        .then(response => response.json())
                        .then(data => {
                            // Create and show flash message
                            showFlashMessage(data.message, data.flash_type);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            showFlashMessage('An error occurred', 'alert');
                        });
                }

                function showFlashMessage(message, type) {
                    // Remove any existing flash messages
                    const existingFlash = document.querySelector('.flash-message');
                    if (existingFlash) {
                        existingFlash.remove();
                    }

                    // Create new flash message
                    const flashDiv = document.createElement('div');
                    flashDiv.className = `flash-message ${type === 'notice' ? 'absolute top-5 right-5 bg-green-100 border-green-400 text-green-700' : 'bg-red-100 border-red-400 text-red-700'} border px-4 py-3 rounded mb-4`;
                    flashDiv.textContent = message;

                    // Insert at the top of the page (adjust selector as needed)
                    const container = document.querySelector('body') || document.querySelector('main');
                    container.insertBefore(flashDiv, container.firstChild);

                    // Auto-hide after 3 seconds
                    setTimeout(() => {
                        flashDiv.remove();
                    }, 3000);
                }
            </script>
          </div>
          <div class="w-7/10">
            <p class="nata-sans text-sm font-normal">Your site name shows on your Dashboard and My Sites page. It's also used in search results. To manage your website title for SEO, <span class="text-blue-500">go to Editor</span></p>
          </div>
        </div>
        <div class="pt-4">
          <h2 class="nata-sans text-base font-semibold">Title on Google and browser tab</h2>
          <p class="nata-sans text-base font-normal">Every page on your site has a title that shows on Google and browser tabs. To customize, <span class="text-blue-500">go to Editor</span></p>
        </div>
      </div>
    </div>

    <div class="bg-gray-50 rounded-lg">
      <div class="py-4 px-6 border-b">
        <h2 class="nata-sans text-lg font-semibold">Site address (URL)</h2>
        <p class="nata-sans text-sm font-normal">Get a branded domain so visitors can easily find your site or edit your free Wix domain.</p>
      </div>
      <div class="py-4 px-6">
        <div class="flex">
          <div class="w-full">
            <p class="nata-sans text-base font-normal">Your site isnâ€™t published yet. When you publish, this will be your domain.</p>
          </div>
        </div>
      </div>
    </div>

    <div class="bg-gray-50 rounded-lg">
      <div class="py-4 px-6 border-b">
        <h2 class="nata-sans text-lg font-semibold">Favicon</h2>
        <p class="nata-sans text-sm font-normal">A favicon is a small icon next to your site title. Get a custom favicon to help visitors recognize your brand and to stand out in their browser tabs.</p>
        <p class="nata-sans text-xs text-gray-500 mt-1">
          Recommended: 16x16, 32x32, or 64x64 pixels. Formats: PNG, ICO, JPG, GIF (max 1MB)
        </p>
      </div>
      <div class="py-4 px-6">
        <div class="flex">
          <div class="w-full">
            <%= form_with model: @website, url: manage_website_settings_path, method: :patch, local: true, multipart: true, class: "space-y-4" do |form| %>
              <div class="flex items-center gap-4">
                <% if @website.favicon.attached? %>
                  <div class="flex flex-col gap-3 w-full">
                    <div class="flex">
                      <div class="w-1/2 flex flex-col gap-3">
                        <p class="nata-sans text-base">Current favicon</p>
                        <div class="flex gap-4">
                          <div class="relative favicon-section w-15">
                            <%= image_tag @website.favicon, alt: "Current favicon", class: "current-favicon w-15 h-15 p-2 shadow-sm object-contain border rounded" %>
                            <button type="button" style="background: rgb(255, 255, 255, 0.5);" class="change-favicon w-15 h-15 absolute left-0 top-0 nata-sans text-xs font-semibold" onclick="document.getElementById('favicon_input').click()"> Change Image</button>
                          </div>
                          <div style="width: calc(100% - 60px)" class="flex flex-col justify-center ">
                            <p class="nata-sans text-base font-semibold">You currently have a favicon attached</p>
                            <p class="nata-sans text-sm">
                              <span onclick="document.getElementById('favicon_input').click();" class="nata-sans text-sm text-blue-500 hover:text-blue-600 underline cursor-pointer">Click here</span>
                              to update your favicon
                            </p>
                          </div>
                        </div>
                      </div>
                      <div class="w-1/2 flex flex-col gap-3 justify-between">
                        <p class="nata-sans text-base">Favicon on Browser Tab</p>
                        <div class="flex gap-4 relative">
                          <%= image_tag 'favicon-holder.png' %>
                          <div class="absolute flex gap-2" style="top: 1.2vw; left: 2vw;">
                            <% if @website.favicon.attached? %>
                              <%= image_tag @website.favicon, alt: "Current favicon", class: "current-favicon w-6 h-6 object-contain" %>
                              <% else %>
                              <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                              </svg>
                            <% end %>
                            <p class="text-sm" style="    line-height: 24px;"><%= @website.name.truncate(30) %></p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                <% else %>
                  <div class="flex flex-col gap-3 w-full">
                    <div class="flex">
                      <div class="w-1/2 flex flex-col gap-3">
                        <p class="nata-sans text-base">Upload favicon</p>
                        <div class="flex gap-4">
                          <div class="relative favicon-section w-15">
                            <div class="w-15 h-15 bg-gray-200 border rounded flex items-center justify-center p-2 shadow-sm">
                              <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                              </svg>
                            </div>
                            <button type="button" style="background: rgb(255, 255, 255, 0.5);" class="change-favicon w-15 h-15 absolute left-0 top-0 nata-sans text-xs font-semibold" onclick="document.getElementById('favicon_input').click()"> Upload Image</button>
                          </div>
                          <div style="width: calc(100% - 60px)" class="flex flex-col justify-center ">
                            <p class="nata-sans text-base font-semibold">No favicon currently uploaded</p>
                            <p class="nata-sans text-sm">
                              <button type="button" class="nata-sans text-sm text-blue-500 hover:text-blue-600 bg-transparent border-0 cursor-pointer underline p-0 m-0" onclick="document.getElementById('favicon_input').click()">
                                Click here
                              </button>
                              to upload your favicon
                            </p>
                          </div>
                        </div>
                      </div>
                      <div class="w-1/2 flex flex-col gap-3 justify-between">
                        <p class="nata-sans text-sm text-gray-600">Favicon on Browser Tab</p>
                        <div class="flex gap-4 relative">
                          <%= image_tag 'favicon-holder.png' %>
                          <div class="absolute flex gap-2" style="top: 1.2vw; left: 2vw;">
                            <% if @website.favicon.attached? %>
                              <%= image_tag @website.favicon, alt: "Current favicon", class: "current-favicon w-6 h-6 object-contain" %>
                            <% else %>
                              <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                              </svg>
                            <% end %>
                            <p class="text-sm" style="    line-height: 24px;"><%= @website.name.truncate(30) %></p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                <% end %>
              </div>

              <div class="flex items-center gap-3 hidden">
                <%= form.file_field :favicon,
                                    id: "favicon_input",
                                    accept: "image/*",
                                    class: "block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",
                                    onchange: "this.form.submit();" %>
              </div>
            <% end %>

            <!-- No additional forms needed - just reuse the existing file input -->
          </div>
        </div>
      </div>
    </div>

    <div class="bg-gray-50 rounded-lg">
      <div class="py-4 px-6 border-b">
        <h2 class="nata-sans text-lg font-semibold">General social image</h2>
        <p class="nata-sans text-sm font-normal">This image will be shared on social networks including Facebook and Twitter. It's a great way to help visitors recognize your brand.</p>
      </div>
      <div class="py-4 px-6">
        <div class="flex">
          <div class="w-full">

          </div>
        </div>
      </div>
    </div>

    <div class="bg-gray-50 rounded-lg">
      <div class="py-4 px-6 border-b">
        <h2 class="nata-sans text-lg font-semibold">Facebook username</h2>
        <p class="nata-sans text-sm font-normal">Facebook needs your personal username to verify any likes you get on your website. To moderate comments, add the Facebook Comments box in the Editor.</p>
      </div>
      <div class="py-4 px-6">
        <div class="flex">
          <div class="w-full">

          </div>
        </div>
      </div>
    </div>

    <div class="bg-gray-50 rounded-lg">
      <div class="py-4 px-6 border-b">
        <h2 class="nata-sans text-lg font-semibold">Site history</h2>
      </div>
      <div class="py-4 px-6">
        <div class="flex">
          <div class="w-full">

          </div>
        </div>
      </div>
    </div>
  </div>



</div>